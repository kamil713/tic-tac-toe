"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,r):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}var $cellElements,$board,$winningMessageElement,$winningMessageTextElement,$resultPlayer,$resultAIorFriend,$restartButton,circleTurn,currentMode,opponentClass,fieldX,fieldY,game=function(){prepareGameElements(),prepareGameEvents()},prepareGameElements=function(){$resultPlayer=document.querySelector(".result__player"),$resultAIorFriend=document.querySelector(".result__ai"),$cellElements=document.querySelectorAll("[data-cell]"),$board=document.getElementById("board"),$winningMessageElement=document.getElementById("winningMessage"),$winningMessageTextElement=document.querySelector("[data-wining-message-text]"),$restartButton=document.querySelectorAll(".restart")},prepareGameEvents=function(){$restartButton.forEach(function(e){e.addEventListener("click",startGame)})},CROSS_CLASS="cross",CIRCLE_CLASS="circle",WINNING_COMBINATIONS=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],gameStatus="still running",currentBoard=[["","",""],["","",""],["","",""]],randomMode=["easy","medium","hard"],randomNumber=Math.floor(3*Math.random());function startGame(){$cellElements.forEach(function(e){e.classList.remove(CROSS_CLASS),e.classList.remove(CIRCLE_CLASS),e.removeEventListener("click",handleClick),e.addEventListener("click",handleClick,{once:!0})}),setBoardHoverClass(),$winningMessageElement.classList.remove("show"),gameStatus="still runinng",currentBoard=[["","",""],["","",""],["","",""]],currentMode=getModeClassForName($selectedDifficulty.textContent),opponentClass=circleTurn?CROSS_CLASS:CIRCLE_CLASS}function handleClick(e){var e=e.target,r=circleTurn?CIRCLE_CLASS:CROSS_CLASS,n=circleTurn?CROSS_CLASS:CIRCLE_CLASS;"still runinng"===gameStatus&&(placeMark(e,r),handleCheckWin(r),checkID(e.id),""==currentBoard[fieldY][fieldX]&&(currentBoard[fieldY][fieldX]=r==CROSS_CLASS?"x":"o")),"still runinng"===gameStatus&&""!==gameMode&&(notify(n),handleCheckWin(n))}function placeMark(e,r){e.classList.add(r)}function checkID(e){fieldY=e<3?(fieldX=e,0):e<6?(fieldX=e-3,1):(fieldX=e-6,2)}function swapTurns(){circleTurn=!circleTurn}function setBoardHoverClass(){$board.classList.remove(CROSS_CLASS),$board.classList.remove(CIRCLE_CLASS),circleTurn?$board.classList.add(CIRCLE_CLASS):$board.classList.add(CROSS_CLASS)}function getModeClassForName(e){return"Random"===e?randomMode[randomNumber]:"Easy"===e?"easy":"Medium"===e?"medium":"Hard"===e?"hard":null}function notify(e){switch(currentMode){case"easy":takeAEasyMove(e);break;case"medium":takeAMediumMove(e);break;case"hard":takeAHardMove(e)}}function handleCheckWin(e){checkWin(e)?endGame(!1):isDraw()?endGame(!0):(swapTurns(),setBoardHoverClass()),checkWin(opponentClass)&&(swapTurns(),setBoardHoverClass())}function checkWin(r){return WINNING_COMBINATIONS.some(function(e){return e.every(function(e){return $cellElements[e].classList.contains(r)})})}function isDraw(){return _toConsumableArray($cellElements).every(function(e){return e.classList.contains(CROSS_CLASS)||e.classList.contains(CIRCLE_CLASS)})}function endGame(e){return e?($winningMessageTextElement.innerText="Draw!",gameStatus="finish",$winningMessageElement.classList.add("show"),!1):($winningMessageTextElement.innerText="".concat(circleTurn?"O's":"X's"," Wins!"),gameStatus="finish",$winningMessageElement.classList.add("show"),opponentClass===CROSS_CLASS&&circleTurn?$resultPlayer.textContent++:opponentClass!==CROSS_CLASS||circleTurn?opponentClass!==CIRCLE_CLASS||circleTurn?opponentClass===CIRCLE_CLASS&&circleTurn&&$resultAIorFriend.textContent++:$resultPlayer.textContent++:$resultAIorFriend.textContent++,!0)}function takeAEasyMove(e){var r=[],n=($cellElements.forEach(function(e){e.classList.contains("cross")||e.classList.contains("circle")||r.push(e)}),r[Math.floor(Math.random()*r.length)]);void 0!==n&&(n.classList.add(e),n.removeEventListener("click",handleClick))}function takeAMediumMove(e){var r,n=[];$cellElements.forEach(function(e){e.classList.contains("cross")||e.classList.contains("circle")||n.push(e)}),Boolean(Math.round(Math.random()))?(r=minMax(n.length,!1,!0),console.log("ai")):(r=n[Math.floor(Math.random()*n.length)].id,console.log("przypadkowa")),void 0!==r&&(console.log(r),$cellElements[r].classList.add(e),$cellElements[r].removeEventListener("click",handleClick),checkID(r),""==currentBoard[fieldY][fieldX]&&(currentBoard[fieldY][fieldX]=circleTurn?"o":"x"))}function takeAHardMove(e){var r=[],n=($cellElements.forEach(function(e){e.classList.contains("cross")||e.classList.contains("circle")||r.push(e)}),minMax(r.length,!1,!0));console.log(n),void 0!==n&&(console.log("wbiÅ‚em tu"),$cellElements[n].classList.add(e),$cellElements[n].removeEventListener("click",handleClick),checkID(n),""==currentBoard[fieldY][fieldX]&&(currentBoard[fieldY][fieldX]=circleTurn?"o":"x"))}function minMax(e,r,n){var t=circleTurn?"x":"o",a=circleTurn?"o":"x",o=!!r;if(checkIfSomeoneHasWon())return o?3:1;if(0==e)return 2;for(var s=0,c=[[0,0,0],[0,0,0],[0,0,0]],l=0;l<3;l++)for(var i=0;i<3;i++)""==currentBoard[l][i]&&(currentBoard[l][i]=o?t:a,c[l][i]=minMax(e-1,!r,!1),currentBoard[l][i]="");if(o)for(var s=3,u=0;u<3;u++)for(var d=0;d<3;d++)0!=c[u][d]&&c[u][d]<s&&(s=c[u][d]);else{var m=0,f=0;s=c[0][0];for(var S=0;S<3;S++)for(var C=0;C<3;C++)c[S][C]>s&&(s=c[S][C],m=C,f=S);if(n)return 3*f+m}return s}function checkIfSomeoneHasWon(){for(var e=0;e<3;e++)if(""!=currentBoard[e][0]&&currentBoard[e][0]==currentBoard[e][1]&&currentBoard[e][1]==currentBoard[e][2])return!0;for(var r=0;r<3;r++)if(""!=currentBoard[0][r]&&currentBoard[0][r]==currentBoard[1][r]&&currentBoard[1][r]==currentBoard[2][r])return!0;return""!=currentBoard[0][0]&&currentBoard[0][0]==currentBoard[1][1]&&currentBoard[1][1]==currentBoard[2][2]||""!=currentBoard[2][0]&&currentBoard[2][0]==currentBoard[1][1]&&currentBoard[1][1]==currentBoard[0][2]}document.addEventListener("DOMContentLoaded",game);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdhbWUuanMiXSwibmFtZXMiOlsiJGNlbGxFbGVtZW50cyIsIiRib2FyZCIsIiR3aW5uaW5nTWVzc2FnZUVsZW1lbnQiLCIkd2lubmluZ01lc3NhZ2VUZXh0RWxlbWVudCIsIiRyZXN1bHRQbGF5ZXIiLCIkcmVzdWx0QUlvckZyaWVuZCIsIiRyZXN0YXJ0QnV0dG9uIiwiY2lyY2xlVHVybiIsIkNJUkNMRV9DTEFTUyIsImdhbWVTdGF0dXMiLCJjdXJyZW50Qm9hcmQiLCJnYW1lIiwicHJlcGFyZUdhbWVFbGVtZW50cyIsInByZXBhcmVHYW1lRXZlbnRzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwicXVlcnlTZWxlY3RvckFsbCIsImdldEVsZW1lbnRCeUlkIiwiZm9yRWFjaCIsImVsIiwiYWRkRXZlbnRMaXN0ZW5lciIsInN0YXJ0R2FtZSIsIldJTk5JTkdfQ09NQklOQVRJT05TIiwicmFuZG9tTW9kZSIsIkNST1NTX0NMQVNTIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiY2VsbCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJoYW5kbGVDbGljayIsIm9uY2UiLCJzZXRCb2FyZEhvdmVyQ2xhc3MiLCJjdXJyZW50TW9kZSIsImdldE1vZGVDbGFzc0Zvck5hbWUiLCIkc2VsZWN0ZWREaWZmaWN1bHR5IiwidGV4dENvbnRlbnQiLCJvcHBvbmVudENsYXNzIiwiZSIsImFpQ3VycmVudENsYXNzIiwicGxhY2VNYXJrIiwidGFyZ2V0IiwiaGFuZGxlQ2hlY2tXaW4iLCJjdXJyZW50Q2xhc3MiLCJjaGVja0lEIiwiaWQiLCJmaWVsZFkiLCJmaWVsZFgiLCJub3RpZnkiLCJhZGQiLCJzd2FwVHVybnMiLCJuYW1lIiwicmFuZG9tTnVtYmVyIiwidHVybiIsInRha2VBRWFzeU1vdmUiLCJ0YWtlQU1lZGl1bU1vdmUiLCJ0YWtlQUhhcmRNb3ZlIiwiY2hlY2tXaW4iLCJlbmRHYW1lIiwiaXNEcmF3Iiwic29tZSIsImNvbWJpbmF0aW9uIiwiZXZlcnkiLCJpbmRleCIsImNvbnRhaW5zIiwiX3RvQ29uc3VtYWJsZUFycmF5IiwiZHJhdyIsImlubmVyVGV4dCIsImNvbmNhdCIsImF2YWlsYWJsZSIsInJhbmRvbUNlbGwiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJwdXNoIiwiQm9vbGVhbiIsInJvdW5kIiwibWluTWF4IiwiY29uc29sZSIsImxvZyIsImFpVHVybiIsInR1cm5YIiwiZGVwdGgwIiwic3VwcCIsImNoZWNrSWZTb21lb25lSGFzV29uIiwiZnJlZUZpZWxkcyIsInZhbHVlT2ZUaGlzTW92ZSIsInZhbHVlc09mTW92ZXMiLCJpIiwiaiIsImh1bWFuVHVybiIsIngiLCJ5Il0sIm1hcHBpbmdzIjoiKytCQUdBLElBQUlBLGNBQ0FDLE9BR0FDLHVCQUNBQywyQkFHQUMsY0FDQUMsa0JBR0FDLGVBc0NBQyxXQVpFQyxZQVlGRCxjQUNBRSxPQUNBQyxPQXRDRUMsS0FBTyxXQWZiQyxzQkFDQUMscUJBbUJNRCxvQkFBc0IsV0FoQjVCUixjQUFBVSxTQUFBQyxjQUFBLG1CQWtCQ1Ysa0JBQW9CUyxTQUFTQyxjQUFjLGVBRTNDZixjQUFnQmMsU0FBU0UsaUJBQWlCLGVBbEIzQ2YsT0FBSUUsU0FBQUEsZUFBNEIsU0FFaENELHVCQUFBWSxTQUFBRyxlQUFBLGtCQW9CQ2QsMkJBQTZCVyxTQUFTQyxjQUFjLDhCQUVwRFQsZUFBaUJRLFNBQVNFLGlCQUFpQixhQWxCNUNILGtCQUFBLFdBc0JFUCxlQUFlWSxRQUFRLFNBQUFDLEdBQVFBLEVBQUdDLGlCQUFpQixRQUFTQyxjQWxCN0RULFlBQUFBLFFBQ0FDLGFBQWlCLFNBRmxCUyxxQkFBQSxDQTBCQyxDQUFDLEVBQUcsRUFBRyxHQXJCUixDQUFBLEVBQU1WLEVBQUFBLEdBdUJMLENBdEJBUixFQUFBQSxFQUFBQSxHQXVCQSxDQXRCQUMsRUFBQUEsRUFBQUEsR0F1QkEsQ0FyQkFMLEVBQUFBLEVBQUFBLEdBc0JBLENBckJBQyxFQUFBQSxFQUFNLEdBc0JOLENBcEJBQyxFQUFBQSxFQUFB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QixtQkFBb0JUIiwiZmlsZSI6ImdhbWUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogKioqKiogKi9cclxuLyogR0FNRSAgKi9cclxuLyogKioqKiogKi9cclxubGV0ICRjZWxsRWxlbWVudHM7IC8vIGluY2x1ZGVzIGFsbCBjZWxscyBvZiB0aGUgZ2FtZSBib2FyZFxyXG5sZXQgJGJvYXJkOyAvLyBhZGRzICdob3ZlcicgZm9yIGFsbCBjZWxscyBmb3IgdGhlIGNvcnJlc3BvbmRpbmcgdHVyblxyXG5cclxuLyogV0lOTklORyBNRVNTQUdFICovXHJcbmxldCAkd2lubmluZ01lc3NhZ2VFbGVtZW50OyAvLyBzaG93cyB3aW4gbWVzc2FnZSB3aGVuIGFsbCBjZWxscyBhcmUgY29tcGxldGVkXHJcbmxldCAkd2lubmluZ01lc3NhZ2VUZXh0RWxlbWVudDsgLy8gY29tcGxldGVzIHdpbiBtZXNzYWdlIGFib3V0IHdobyB3b24sIHRpZWQgb3IgbG9zdFxyXG5cclxuLyogU0NPUkUgU1BBTiAqL1xyXG5sZXQgJHJlc3VsdFBsYXllcjsgLy8gcGxhY2Ugd2hlcmUgYXBwIGRpc3BsYXlzIHRoZSBwbGF5ZXIncyBzY29yZVxyXG5sZXQgJHJlc3VsdEFJb3JGcmllbmQ7IC8vIHBsYWNlIHdoZXJlIGFwcCBkaXNwbGF5cyB0aGUgcmVzdWx0IG9mIGFpIG9yIGZyaWVuZFxyXG5cclxuLyogUkVTVEFSVCAqL1xyXG5sZXQgJHJlc3RhcnRCdXR0b247IC8vIGlzIHVzZWQgdG8gY2xlYXIgZ2FtZSBib2FyZCBvciByZXNldCBnYW1lIGlmIHRoZSBnYW1lIGlzIG92ZXJcclxuXHJcbmNvbnN0IGdhbWUgPSAoKSA9PiB7XHJcblx0cHJlcGFyZUdhbWVFbGVtZW50cygpO1xyXG5cdHByZXBhcmVHYW1lRXZlbnRzKCk7XHJcbn07XHJcblxyXG5jb25zdCBwcmVwYXJlR2FtZUVsZW1lbnRzID0gKCkgPT4ge1xyXG5cdCRyZXN1bHRQbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucmVzdWx0X19wbGF5ZXInKTtcclxuXHQkcmVzdWx0QUlvckZyaWVuZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5yZXN1bHRfX2FpJyk7XHJcblxyXG5cdCRjZWxsRWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1jZWxsXScpO1xyXG5cdCRib2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib2FyZCcpO1xyXG5cclxuXHQkd2lubmluZ01lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpbm5pbmdNZXNzYWdlJyk7XHJcblx0JHdpbm5pbmdNZXNzYWdlVGV4dEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS13aW5pbmctbWVzc2FnZS10ZXh0XScpO1xyXG5cclxuXHQkcmVzdGFydEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZXN0YXJ0Jyk7XHJcbn07XHJcblxyXG5jb25zdCBwcmVwYXJlR2FtZUV2ZW50cyA9ICgpID0+IHtcclxuICAkcmVzdGFydEJ1dHRvbi5mb3JFYWNoKGVsID0+IHsgZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdGFydEdhbWUpOyB9KTtcclxufTtcclxuXHJcbi8qIEdBTUUgVkFSSUFCTEVTICovXHJcbmNvbnN0IENST1NTX0NMQVNTID0gJ2Nyb3NzJztcclxuY29uc3QgQ0lSQ0xFX0NMQVNTID0gJ2NpcmNsZSc7XHJcbmNvbnN0IFdJTk5JTkdfQ09NQklOQVRJT05TID0gW1xyXG5cdFswLCAxLCAyXSxcclxuXHRbMywgNCwgNV0sXHJcblx0WzYsIDcsIDhdLFxyXG5cdFswLCAzLCA2XSxcclxuXHRbMSwgNCwgN10sXHJcblx0WzIsIDUsIDhdLFxyXG5cdFswLCA0LCA4XSxcclxuXHRbMiwgNCwgNl0sXHJcbl07XHJcblxyXG5sZXQgY2lyY2xlVHVybjtcclxubGV0IGdhbWVTdGF0dXMgPSAnc3RpbGwgcnVubmluZyc7XHJcbmxldCBjdXJyZW50Qm9hcmQgPSBbXHJcblx0WycnLCAnJywgJyddLFxyXG5cdFsnJywgJycsICcnXSxcclxuXHRbJycsICcnLCAnJ10sXHJcbl07XHJcblxyXG5sZXQgcmFuZG9tTW9kZSA9IFsnZWFzeScsICdtZWRpdW0nLCAnaGFyZCddO1xyXG5sZXQgcmFuZG9tTnVtYmVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMyk7XHJcbmxldCBjdXJyZW50TW9kZTtcclxuXHJcbmxldCBvcHBvbmVudENsYXNzO1xyXG5sZXQgZmllbGRYO1xyXG5sZXQgZmllbGRZO1xyXG5cclxuLyogKioqKioqKioqKiAqL1xyXG4vKiBHQU1FIExPR0lDICovXHJcbi8qICoqKioqKioqKiogKi9cclxuXHJcbi8qIFNUQVJUUyBUSEUgR0FNRSBBTkQgUkVTRVRTIFRIRSBWQVJJQUJMRVMgKi9cclxuZnVuY3Rpb24gc3RhcnRHYW1lKCkge1xyXG5cdCRjZWxsRWxlbWVudHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xyXG5cdFx0Y2VsbC5jbGFzc0xpc3QucmVtb3ZlKENST1NTX0NMQVNTKTtcclxuXHRcdGNlbGwuY2xhc3NMaXN0LnJlbW92ZShDSVJDTEVfQ0xBU1MpO1xyXG5cdFx0Y2VsbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIGhhbmRsZUNsaWNrKTtcclxuXHRcdGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljaywgeyBvbmNlOiB0cnVlIH0pO1xyXG5cdH0pO1xyXG5cclxuXHRzZXRCb2FyZEhvdmVyQ2xhc3MoKTtcclxuXHQkd2lubmluZ01lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3cnKTtcclxuXHRnYW1lU3RhdHVzID0gJ3N0aWxsIHJ1bmlubmcnO1xyXG5cdGN1cnJlbnRCb2FyZCA9IFtcclxuXHRcdFsnJywgJycsICcnXSxcclxuXHRcdFsnJywgJycsICcnXSxcclxuXHRcdFsnJywgJycsICcnXSxcclxuXHRdO1xyXG5cdGN1cnJlbnRNb2RlID0gZ2V0TW9kZUNsYXNzRm9yTmFtZSgkc2VsZWN0ZWREaWZmaWN1bHR5LnRleHRDb250ZW50KTtcclxuXHRvcHBvbmVudENsYXNzID0gIWNpcmNsZVR1cm4gPyBDSVJDTEVfQ0xBU1MgOiBDUk9TU19DTEFTUztcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2xpY2soZSkge1xyXG5cdGNvbnN0IGNlbGwgPSBlLnRhcmdldDtcclxuXHRjb25zdCBjdXJyZW50Q2xhc3MgPSBjaXJjbGVUdXJuID8gQ0lSQ0xFX0NMQVNTIDogQ1JPU1NfQ0xBU1M7XHJcblx0Y29uc3QgYWlDdXJyZW50Q2xhc3MgPSAhY2lyY2xlVHVybiA/IENJUkNMRV9DTEFTUyA6IENST1NTX0NMQVNTO1xyXG5cclxuXHRpZiAoZ2FtZVN0YXR1cyA9PT0gJ3N0aWxsIHJ1bmlubmcnKSB7XHJcblx0XHRwbGFjZU1hcmsoY2VsbCwgY3VycmVudENsYXNzKTtcclxuXHRcdGhhbmRsZUNoZWNrV2luKGN1cnJlbnRDbGFzcyk7XHJcblxyXG5cdFx0Y2hlY2tJRChjZWxsLmlkKTtcclxuXHRcdGlmIChjdXJyZW50Qm9hcmRbZmllbGRZXVtmaWVsZFhdID09ICcnKSB7XHJcblx0XHRcdGN1cnJlbnRCb2FyZFtmaWVsZFldW2ZpZWxkWF0gPSBjdXJyZW50Q2xhc3MgPT0gQ1JPU1NfQ0xBU1MgPyAneCcgOiAnbyc7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRpZiAoZ2FtZVN0YXR1cyA9PT0gJ3N0aWxsIHJ1bmlubmcnKSB7XHJcblx0XHRpZiAoZ2FtZU1vZGUgIT09ICcnKSB7XHJcblx0XHRcdG5vdGlmeShhaUN1cnJlbnRDbGFzcyk7XHJcblx0XHRcdGhhbmRsZUNoZWNrV2luKGFpQ3VycmVudENsYXNzKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBsYWNlTWFyayhjZWxsLCBjdXJyZW50Q2xhc3MpIHtcclxuXHRjZWxsLmNsYXNzTGlzdC5hZGQoY3VycmVudENsYXNzKTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tJRChpZCkge1xyXG5cdGlmIChpZCA8IDMpIHtcclxuXHRcdGZpZWxkWCA9IGlkO1xyXG5cdFx0ZmllbGRZID0gMDtcclxuXHR9IGVsc2UgaWYgKGlkIDwgNikge1xyXG5cdFx0ZmllbGRYID0gaWQgLSAzO1xyXG5cdFx0ZmllbGRZID0gMTtcclxuXHR9IGVsc2Uge1xyXG5cdFx0ZmllbGRYID0gaWQgLSA2O1xyXG5cdFx0ZmllbGRZID0gMjtcclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHN3YXBUdXJucygpIHtcclxuXHRjaXJjbGVUdXJuID0gIWNpcmNsZVR1cm47XHJcbn1cclxuXHJcbi8qIGxpa2UgYWJvdmUgJGJvYXJkIC0gYWRkcyAnaG92ZXInIGZvciB0aGUgY29ycmVzcG9uZGluZyBjbGFzcyAqL1xyXG5mdW5jdGlvbiBzZXRCb2FyZEhvdmVyQ2xhc3MoKSB7XHJcblx0JGJvYXJkLmNsYXNzTGlzdC5yZW1vdmUoQ1JPU1NfQ0xBU1MpO1xyXG5cdCRib2FyZC5jbGFzc0xpc3QucmVtb3ZlKENJUkNMRV9DTEFTUyk7XHJcblx0aWYgKGNpcmNsZVR1cm4pIHtcclxuXHRcdCRib2FyZC5jbGFzc0xpc3QuYWRkKENJUkNMRV9DTEFTUyk7XHJcblx0fSBlbHNlIHtcclxuXHRcdCRib2FyZC5jbGFzc0xpc3QuYWRkKENST1NTX0NMQVNTKTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG4vKiBTRVQgVEhFIExFVkVMIEZPUiBBSSAgKi9cclxuZnVuY3Rpb24gZ2V0TW9kZUNsYXNzRm9yTmFtZShuYW1lKSB7XHJcblx0aWYgKG5hbWUgPT09ICdSYW5kb20nKSByZXR1cm4gcmFuZG9tTW9kZVtyYW5kb21OdW1iZXJdO1xyXG5cdGlmIChuYW1lID09PSAnRWFzeScpIHJldHVybiAnZWFzeSc7XHJcblx0aWYgKG5hbWUgPT09ICdNZWRpdW0nKSByZXR1cm4gJ21lZGl1bSc7XHJcblx0aWYgKG5hbWUgPT09ICdIYXJkJykgcmV0dXJuICdoYXJkJztcclxuXHRyZXR1cm4gbnVsbDtcclxufVxyXG5cclxuZnVuY3Rpb24gbm90aWZ5KHR1cm4pIHtcclxuXHRzd2l0Y2ggKGN1cnJlbnRNb2RlKSB7XHJcblx0XHRjYXNlICdlYXN5JzpcclxuXHRcdFx0dGFrZUFFYXN5TW92ZSh0dXJuKTtcclxuXHRcdFx0YnJlYWs7XHJcblx0XHRjYXNlICdtZWRpdW0nOlxyXG5cdFx0XHR0YWtlQU1lZGl1bU1vdmUodHVybik7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSAnaGFyZCc6XHJcblx0XHRcdHRha2VBSGFyZE1vdmUodHVybik7XHJcblx0XHRcdGJyZWFrO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbi8qIENIRUNLSU5HIFRIRSBXSU5OSU5HUyBBTkQgVVBEQVRJTkcgVEhFIFNDT1JFICovXHJcbmZ1bmN0aW9uIGhhbmRsZUNoZWNrV2luKGN1cnJlbnRDbGFzcykge1xyXG5cdGlmIChjaGVja1dpbihjdXJyZW50Q2xhc3MpKSB7XHJcblx0XHRlbmRHYW1lKGZhbHNlKTtcclxuXHR9IGVsc2UgaWYgKGlzRHJhdygpKSB7XHJcblx0XHRlbmRHYW1lKHRydWUpO1xyXG5cdH0gZWxzZSB7XHJcblx0XHRzd2FwVHVybnMoKTtcclxuXHRcdHNldEJvYXJkSG92ZXJDbGFzcygpO1xyXG5cdH1cclxuXHJcblx0aWYgKGNoZWNrV2luKG9wcG9uZW50Q2xhc3MpKSB7XHJcblx0XHRzd2FwVHVybnMoKTtcclxuXHRcdHNldEJvYXJkSG92ZXJDbGFzcygpO1xyXG5cdH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tXaW4oY3VycmVudENsYXNzKSB7XHJcblx0cmV0dXJuIFdJTk5JTkdfQ09NQklOQVRJT05TLnNvbWUoKGNvbWJpbmF0aW9uKSA9PiB7XHJcblx0XHRyZXR1cm4gY29tYmluYXRpb24uZXZlcnkoKGluZGV4KSA9PiB7XHJcblx0XHRcdHJldHVybiAkY2VsbEVsZW1lbnRzW2luZGV4XS5jbGFzc0xpc3QuY29udGFpbnMoY3VycmVudENsYXNzKTtcclxuXHRcdH0pO1xyXG5cdH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0RyYXcoKSB7XHJcblx0cmV0dXJuIFsuLi4kY2VsbEVsZW1lbnRzXS5ldmVyeSgoY2VsbCkgPT4ge1xyXG5cdFx0cmV0dXJuIChcclxuXHRcdFx0Y2VsbC5jbGFzc0xpc3QuY29udGFpbnMoQ1JPU1NfQ0xBU1MpIHx8XHJcblx0XHRcdGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKENJUkNMRV9DTEFTUylcclxuXHRcdCk7XHJcblx0fSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGVuZEdhbWUoZHJhdykge1xyXG5cdGlmIChkcmF3KSB7XHJcblx0XHQkd2lubmluZ01lc3NhZ2VUZXh0RWxlbWVudC5pbm5lclRleHQgPSAnRHJhdyEnO1xyXG5cdFx0Z2FtZVN0YXR1cyA9ICdmaW5pc2gnO1xyXG5cdFx0JHdpbm5pbmdNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fSBlbHNlIHtcclxuXHRcdCR3aW5uaW5nTWVzc2FnZVRleHRFbGVtZW50LmlubmVyVGV4dCA9IGAke2NpcmNsZVR1cm4gPyBcIk8nc1wiIDogXCJYJ3NcIn0gV2lucyFgO1xyXG5cdFx0Z2FtZVN0YXR1cyA9ICdmaW5pc2gnO1xyXG5cdFx0JHdpbm5pbmdNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKCdzaG93Jyk7XHJcblxyXG5cdFx0aWYgKG9wcG9uZW50Q2xhc3MgPT09IENST1NTX0NMQVNTICYmIGNpcmNsZVR1cm4pIHtcclxuXHRcdFx0JHJlc3VsdFBsYXllci50ZXh0Q29udGVudCsrO1xyXG5cdFx0fSBlbHNlIGlmIChvcHBvbmVudENsYXNzID09PSBDUk9TU19DTEFTUyAmJiAhY2lyY2xlVHVybikge1xyXG5cdFx0XHQkcmVzdWx0QUlvckZyaWVuZC50ZXh0Q29udGVudCsrO1xyXG5cdFx0fSBlbHNlIGlmIChvcHBvbmVudENsYXNzID09PSBDSVJDTEVfQ0xBU1MgJiYgIWNpcmNsZVR1cm4pIHtcclxuXHRcdFx0JHJlc3VsdFBsYXllci50ZXh0Q29udGVudCsrO1xyXG5cdFx0fSBlbHNlIGlmIChvcHBvbmVudENsYXNzID09PSBDSVJDTEVfQ0xBU1MgJiYgY2lyY2xlVHVybikge1xyXG5cdFx0XHQkcmVzdWx0QUlvckZyaWVuZC50ZXh0Q29udGVudCsrO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbi8qIFNFTEVDVElORyBUSEUgTU9WRU1FTlQgRk9SIFRIRSBTRUxFQ1RFRCBESUZGSUNVTFRZIExFVkVMICovXHJcbmZ1bmN0aW9uIHRha2VBRWFzeU1vdmUodHVybikge1xyXG5cdGxldCBhdmFpbGFibGUgPSBbXTtcclxuXHQkY2VsbEVsZW1lbnRzLmZvckVhY2goKGNlbGwpID0+IHtcclxuXHRcdGlmIChcclxuXHRcdFx0IWNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdjcm9zcycpICYmXHJcblx0XHRcdCFjZWxsLmNsYXNzTGlzdC5jb250YWlucygnY2lyY2xlJylcclxuXHRcdCkge1xyXG5cdFx0XHRhdmFpbGFibGUucHVzaChjZWxsKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0bGV0IHJhbmRvbUNlbGwgPSBhdmFpbGFibGVbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXZhaWxhYmxlLmxlbmd0aCldO1xyXG5cdGlmIChyYW5kb21DZWxsICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdHJhbmRvbUNlbGwuY2xhc3NMaXN0LmFkZCh0dXJuKTtcclxuXHRcdHJhbmRvbUNlbGwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljayk7XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiB0YWtlQU1lZGl1bU1vdmUodHVybikge1xyXG5cdGxldCBhdmFpbGFibGUgPSBbXTtcclxuXHQkY2VsbEVsZW1lbnRzLmZvckVhY2goKGNlbGwpID0+IHtcclxuXHRcdGlmIChcclxuXHRcdFx0IWNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdjcm9zcycpICYmXHJcblx0XHRcdCFjZWxsLmNsYXNzTGlzdC5jb250YWlucygnY2lyY2xlJylcclxuXHRcdCkge1xyXG5cdFx0XHRhdmFpbGFibGUucHVzaChjZWxsKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0bGV0IHJhbmRvbUNlbGw7XHJcblx0aWYgKEJvb2xlYW4oTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKSkpIHtcclxuXHRcdHJhbmRvbUNlbGwgPSBtaW5NYXgoYXZhaWxhYmxlLmxlbmd0aCwgZmFsc2UsIHRydWUpO1xyXG5cdFx0Y29uc29sZS5sb2coJ2FpJyk7XHJcblx0fSBlbHNlIHtcclxuXHRcdHJhbmRvbUNlbGwgPSBhdmFpbGFibGVbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXZhaWxhYmxlLmxlbmd0aCldLmlkOyAvL1xyXG5cdFx0Y29uc29sZS5sb2coJ3ByenlwYWRrb3dhJyk7XHJcblx0fVxyXG5cclxuXHRpZiAocmFuZG9tQ2VsbCAhPT0gdW5kZWZpbmVkKSB7XHJcblx0XHRjb25zb2xlLmxvZyhyYW5kb21DZWxsKTtcclxuXHRcdCRjZWxsRWxlbWVudHNbcmFuZG9tQ2VsbF0uY2xhc3NMaXN0LmFkZCh0dXJuKTtcclxuXHRcdCRjZWxsRWxlbWVudHNbcmFuZG9tQ2VsbF0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVDbGljayk7XHJcblxyXG5cdFx0Y2hlY2tJRChyYW5kb21DZWxsKTtcclxuXHRcdGlmIChjdXJyZW50Qm9hcmRbZmllbGRZXVtmaWVsZFhdID09ICcnKSB7XHJcblx0XHRcdGN1cnJlbnRCb2FyZFtmaWVsZFldW2ZpZWxkWF0gPSAhY2lyY2xlVHVybiA/ICd4JyA6ICdvJztcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRha2VBSGFyZE1vdmUodHVybikge1xyXG5cdGxldCBhdmFpbGFibGUgPSBbXTtcclxuXHQkY2VsbEVsZW1lbnRzLmZvckVhY2goKGNlbGwpID0+IHtcclxuXHRcdGlmIChcclxuXHRcdFx0IWNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdjcm9zcycpICYmXHJcblx0XHRcdCFjZWxsLmNsYXNzTGlzdC5jb250YWlucygnY2lyY2xlJylcclxuXHRcdCkge1xyXG5cdFx0XHRhdmFpbGFibGUucHVzaChjZWxsKTtcclxuXHRcdH1cclxuXHR9KTtcclxuXHJcblx0bGV0IHJhbmRvbUNlbGwgPSBtaW5NYXgoYXZhaWxhYmxlLmxlbmd0aCwgZmFsc2UsIHRydWUpO1xyXG5cdGNvbnNvbGUubG9nKHJhbmRvbUNlbGwpO1xyXG5cdGlmIChyYW5kb21DZWxsICE9PSB1bmRlZmluZWQpIHtcclxuXHRcdGNvbnNvbGUubG9nKCd3YmnFgmVtIHR1Jyk7XHJcblx0XHQkY2VsbEVsZW1lbnRzW3JhbmRvbUNlbGxdLmNsYXNzTGlzdC5hZGQodHVybik7XHJcblx0XHQkY2VsbEVsZW1lbnRzW3JhbmRvbUNlbGxdLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlQ2xpY2spO1xyXG5cclxuXHRcdGNoZWNrSUQocmFuZG9tQ2VsbCk7XHJcblx0XHRpZiAoY3VycmVudEJvYXJkW2ZpZWxkWV1bZmllbGRYXSA9PSAnJykge1xyXG5cdFx0XHRjdXJyZW50Qm9hcmRbZmllbGRZXVtmaWVsZFhdID0gIWNpcmNsZVR1cm4gPyAneCcgOiAnbyc7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5cclxuLyogQUkgfHwgTUlOSU1BWCBBTEdPUklUSE0gKi9cclxuZnVuY3Rpb24gbWluTWF4KGZyZWVGaWVsZHMsIHR1cm5YLCBkZXB0aDApIHtcclxuXHRjb25zdCBodW1hblR1cm4gPSBjaXJjbGVUdXJuID8gJ3gnIDogJ28nO1xyXG5cdGNvbnN0IGFpVHVybiA9ICFjaXJjbGVUdXJuID8gJ3gnIDogJ28nO1xyXG5cclxuXHRsZXQgc3VwcCA9IHR1cm5YID8gdHJ1ZSA6IGZhbHNlO1xyXG5cclxuXHRpZiAoY2hlY2tJZlNvbWVvbmVIYXNXb24oKSkge1xyXG5cdFx0aWYgKHN1cHApIHJldHVybiAzO1xyXG5cdFx0ZWxzZSByZXR1cm4gMTtcclxuXHR9XHJcblxyXG5cdGlmIChmcmVlRmllbGRzID09IDApIHJldHVybiAyO1xyXG5cdGxldCB2YWx1ZU9mVGhpc01vdmUgPSAwO1xyXG5cdGxldCB2YWx1ZXNPZk1vdmVzID0gW1xyXG5cdFx0WzAsIDAsIDBdLFxyXG5cdFx0WzAsIDAsIDBdLFxyXG5cdFx0WzAsIDAsIDBdLFxyXG5cdF07XHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcclxuXHRcdGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7XHJcblx0XHRcdGlmIChjdXJyZW50Qm9hcmRbaV1bal0gPT0gJycpIHtcclxuXHRcdFx0XHRpZiAoc3VwcCkgY3VycmVudEJvYXJkW2ldW2pdID0gaHVtYW5UdXJuO1xyXG5cdFx0XHRcdGVsc2UgY3VycmVudEJvYXJkW2ldW2pdID0gYWlUdXJuO1xyXG5cdFx0XHRcdHZhbHVlc09mTW92ZXNbaV1bal0gPSBtaW5NYXgoZnJlZUZpZWxkcyAtIDEsICF0dXJuWCwgZmFsc2UpO1xyXG5cdFx0XHRcdGN1cnJlbnRCb2FyZFtpXVtqXSA9ICcnO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRpZiAoc3VwcCkge1xyXG5cdFx0dmFsdWVPZlRoaXNNb3ZlID0gMztcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgMzsgaSsrKVxyXG5cdFx0XHRmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKylcclxuXHRcdFx0XHRpZiAodmFsdWVzT2ZNb3Zlc1tpXVtqXSAhPSAwICYmIHZhbHVlc09mTW92ZXNbaV1bal0gPCB2YWx1ZU9mVGhpc01vdmUpXHJcblx0XHRcdFx0XHR2YWx1ZU9mVGhpc01vdmUgPSB2YWx1ZXNPZk1vdmVzW2ldW2pdO1xyXG5cdH0gZWxzZSB7XHJcblx0XHRsZXQgeCA9IDA7XHJcblx0XHRsZXQgeSA9IDA7XHJcblx0XHR2YWx1ZU9mVGhpc01vdmUgPSB2YWx1ZXNPZk1vdmVzWzBdWzBdO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHtcclxuXHRcdFx0Zm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHtcclxuXHRcdFx0XHRpZiAodmFsdWVzT2ZNb3Zlc1tpXVtqXSA+IHZhbHVlT2ZUaGlzTW92ZSkge1xyXG5cdFx0XHRcdFx0dmFsdWVPZlRoaXNNb3ZlID0gdmFsdWVzT2ZNb3Zlc1tpXVtqXTtcclxuXHRcdFx0XHRcdHggPSBqO1xyXG5cdFx0XHRcdFx0eSA9IGk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRpZiAoZGVwdGgwKSByZXR1cm4geSAqIDMgKyB4O1xyXG5cdH1cclxuXHJcblx0cmV0dXJuIHZhbHVlT2ZUaGlzTW92ZTtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tJZlNvbWVvbmVIYXNXb24oKSB7XHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspXHJcblx0XHRpZiAoXHJcblx0XHRcdGN1cnJlbnRCb2FyZFtpXVswXSAhPSAnJyAmJlxyXG5cdFx0XHRjdXJyZW50Qm9hcmRbaV1bMF0gPT0gY3VycmVudEJvYXJkW2ldWzFdICYmXHJcblx0XHRcdGN1cnJlbnRCb2FyZFtpXVsxXSA9PSBjdXJyZW50Qm9hcmRbaV1bMl1cclxuXHRcdClcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspXHJcblx0XHRpZiAoXHJcblx0XHRcdGN1cnJlbnRCb2FyZFswXVtpXSAhPSAnJyAmJlxyXG5cdFx0XHRjdXJyZW50Qm9hcmRbMF1baV0gPT0gY3VycmVudEJvYXJkWzFdW2ldICYmXHJcblx0XHRcdGN1cnJlbnRCb2FyZFsxXVtpXSA9PSBjdXJyZW50Qm9hcmRbMl1baV1cclxuXHRcdClcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0aWYgKFxyXG5cdFx0Y3VycmVudEJvYXJkWzBdWzBdICE9ICcnICYmXHJcblx0XHRjdXJyZW50Qm9hcmRbMF1bMF0gPT0gY3VycmVudEJvYXJkWzFdWzFdICYmXHJcblx0XHRjdXJyZW50Qm9hcmRbMV1bMV0gPT0gY3VycmVudEJvYXJkWzJdWzJdXHJcblx0KVxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0aWYgKFxyXG5cdFx0Y3VycmVudEJvYXJkWzJdWzBdICE9ICcnICYmXHJcblx0XHRjdXJyZW50Qm9hcmRbMl1bMF0gPT0gY3VycmVudEJvYXJkWzFdWzFdICYmXHJcblx0XHRjdXJyZW50Qm9hcmRbMV1bMV0gPT0gY3VycmVudEJvYXJkWzBdWzJdXHJcblx0KVxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0cmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgZ2FtZSk7Il19
